# 物理实验报告助手 (Physics Lab Report Assistant)

基于 AI 的智能物理实验报告协作工具，集成 OCR 识别、数据分析与拟合、LLM 协作生成功能，帮助快速完成高质量的物理实验报告。

## 功能特性

### 1. OCR 识别
- 支持从实验数据图像中提取文本和表格
- AI 视觉识别（推荐）：基于通义千问多模态大模型，对手写文字和复杂表格识别效果更好
- 传统 OCR：基于 PaddleOCR
- 可在线编辑识别结果并保存

### 2. 数据分析与拟合
- 线性拟合（加权最小二乘法，支持误差棒）
- 对数拟合 (y = a ln(x) + b)
- 双对数拟合（幂律：y = C x^k）
- 傅里叶变换
- 自动生成可视化图表，保存为标准文件名（拟合类型_时间戳.png）
- 支持自定义坐标轴标签（物理量命名）
- 显示加权 R²、Reduced χ²、参数不确定度
- 支持自定义标题、标签等

### 3. LLM 协作
- **计划模式**：大模型提出澄清问题，确保充分理解实验背景
- **执行模式**：根据数据和分析结果生成文字分析（200-400字）
  - 模型说明与参数解释
  - 不确定度与可靠性分析
  - 局限性与改进建议
- 严格遵循"禁止编造与夸大"原则，仅基于已提供数据
- 自动生成标准 LaTeX 表格和图表插入代码
- 提供拟合图表下载链接（文件名与 LaTeX 引用一致）

## 工作流程

**OCR 识别** → **数据分析与拟合** → **LLM 协作生成报告**

1. 上传实验图像，使用 OCR 提取数据表格
2. 在线编辑表格，确保数据准确
3. 选择拟合模型（线性/对数/幂律/FFT），执行分析
4. 查看拟合图表和统计参数（R²、χ²、不确定度）
5. 进入 LLM 协作页面，利用 AI 生成实验分析文字
6. 获取 LaTeX 表格、图表插入代码和图表文件下载链接

## 项目结构

```
final_assignment/
├── app.py                  # Streamlit 主应用
├── ocr_module.py          # OCR 识别模块（PaddleOCR + Qwen-VL）
├── analysis_module.py     # 数据分析模块（加权拟合、不确定度传播）
├── latex_generator.py     # LaTeX 生成模块（表格、图表模板）
├── llm_integration.py     # LLM 集成模块（通义千问）
├── testllm.py             # LLM 功能测试脚本
├── requirements.txt       # 依赖包列表
├── .env                   # 环境变量配置（不上传 git）
├── .gitignore             # Git 忽略文件配置
├── plots/                 # 拟合图表保存目录（自动生成）
└── README.md              # 项目说明文档
```

## 环境配置

### 1. 依赖安装

```bash
pip install -r requirements.txt
```

### 2. API密钥配置

在`.env`文件中配置阿里云API密钥：

```env
DASHSCOPE_API_KEY=your_api_key_here
```

## 使用方法

### 1. 启动应用

```bash
cd "g:\课程\物理与人工智能\final_assignment"
streamlit run app.py
```

### 2. 工作流程

#### 步骤 1：OCR 识别
- 上传包含实验数据的图像
- 选择识别方式：
  - **AI 视觉识别**（推荐）：适合手写文字和复杂表格
  - **传统 OCR**：适合打印清晰的表格
- 在线编辑识别结果，确保数据准确
- 点击"保存编辑并进入拟合步骤"

#### 步骤 2：数据分析与拟合
- 选择 X 轴和 Y 轴列（支持自定义物理量名称）
- 可选：输入误差列（y_err, x_err）
- 选择拟合模型：
  - **线性拟合**：y = kx + b（加权最小二乘）
  - **对数拟合**：y = a ln(x) + b
  - **幂律拟合**：y = C x^k（双对数）
  - **傅里叶变换**：频域分析
- 查看拟合结果：参数、不确定度、R²、Reduced χ²
- 拟合图表自动保存到 `plots/` 目录
- 点击"进入 LLM 协作"

#### 步骤 3：LLM 协作
- **查看数据与分析汇总**：展开查看已提供的表格数据和拟合结果
- **计划模式**：
  - 点击"生成计划和问题"
  - AI 提出澄清性问题（实验名称、测量条件、预期结论等）
  - 根据 AI 提问补充实验背景信息
- **执行模式**：
  - 在备注框中填写 AI 提问的答案
  - 点击"生成文字分析"
  - 获取基于数据的实验分析（200-400字）
- **获取 LaTeX 代码**：
  - 标准表格代码（基于实际数据）
  - 图表插入代码（文件名与保存的图表一致）
  - 下载拟合图表文件

### 3. 测试 LLM 功能

运行测试脚本验证 LLM 集成：

```bash
python testllm.py
```

该脚本使用样本数据测试计划和执行模式。

## 模块说明

### OCR 模块 (ocr_module.py)
- PaddleOCR：传统 OCR 识别（打印体）
- Qwen-VL 多模态：AI 视觉识别（手写体、复杂表格）

### 数据分析模块 (analysis_module.py)
- 加权最小二乘拟合（线性、对数、幂律）
- 支持误差传播和不确定度计算
- Reduced χ² 统计量评估拟合优度
- 不确定度格式化（2 位有效数字，物理报告标准）

### LaTeX 生成模块 (latex_generator.py)
- Jinja2 模板引擎
- 标准表格和图表环境生成
- 支持多列表格和自定义标签

### LLM 集成模块 (llm_integration.py)
- 阿里云通义千问 API（OpenAI 兼容接口）
- 计划模式：澄清实验背景和需求
- 执行模式：生成文字分析（禁止编造与夸大）
- Qwen-VL：多模态 OCR（图像理解）

## 技术栈

- **UI 框架**：Streamlit（自定义路由导航）
- **OCR**：PaddleOCR、Qwen-VL（通义千问多模态）
- **科学计算**：NumPy、SciPy（加权拟合、FFT）
- **可视化**：Matplotlib（误差棒、不确定度标注）
- **LLM**：阿里云 DashScope API（Qwen-Max）
- **LaTeX**：Jinja2 模板
- **环境管理**：python-dotenv

## 注意事项

1. **API 密钥配置**：在 `.env` 文件中配置 `DASHSCOPE_API_KEY`（阿里云 DashScope API）
2. **图像质量**：OCR 识别效果受图像清晰度影响，建议使用高分辨率、光线均匀的图像
3. **误差输入**：拟合时可选择输入 y_err 和 x_err 列，以启用加权最小二乘法
4. **文件管理**：拟合图表自动保存到 `plots/` 目录，文件名格式：`<拟合类型>_<时间戳>.png`
5. **LLM 使用原则**：严格遵循"禁止编造与夸大"，仅基于已提供数据生成分析
6. **Git 上传**：`.gitignore` 已配置，不会上传 `.env`、`test/`、`testllm.py`、`plots/` 等敏感和临时文件

## License

MIT License

3. 建议使用清晰的实验数据图像以获得更好的识别效果
4. 分析功能需要数值型数据
